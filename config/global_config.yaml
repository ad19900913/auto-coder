# 自动化AI任务执行系统 - 全局配置文件
# 版本: 1.0
# 更新时间: 2025-01-20

# 系统基本信息
name: "自动化AI任务执行系统"
version: "1.0.0"
max_concurrent_tasks: 5

# AI服务配置
ai_services:
  default: "${DEFAULT_AI_SERVICE}"  # 默认AI服务
  claude:
    api_key: "${CLAUDE_API_KEY}"
    base_url: "https://api.anthropic.com"
    model: "claude-3-sonnet-20240229"
    max_tokens: 4000
    temperature: 0.1
    
    # 高级参数
    parameters:
      temperature: 0.1
      max_tokens: 4000
      top_p: 0.9
      frequency_penalty: 0.0
      presence_penalty: 0.0
      stop_sequences: []
    
    # 任务类型特定参数
    task_parameters:
      coding:
        temperature: 0.05
        max_tokens: 6000
      review:
        temperature: 0.1
        max_tokens: 3000
      requirement_review:
        temperature: 0.15
        max_tokens: 5000
  
  deepseek:
    api_key: "${DEEPSEEK_API_KEY}"
    base_url: "https://api.deepseek.com"
    model: "deepseek-reasoner"
    max_tokens: 4000
    temperature: 0.1
    
    # 高级参数
    parameters:
      temperature: 0.1
      max_tokens: 4000
      top_p: 0.9
      repetition_penalty: 1.0
      top_k: 40
    
    # 任务类型特定参数
    task_parameters:
      coding:
        temperature: 0.05
        max_tokens: 6000
      review:
        temperature: 0.1
        max_tokens: 3000
      requirement_review:
        temperature: 0.15
        max_tokens: 5000
  
  gemini:
    api_key: "${GEMINI_API_KEY}"
    base_url: "https://generativelanguage.googleapis.com"
    model: "gemini-2.5-pro"
    max_tokens: 4000
    temperature: 0.1
    
    # 高级参数
    parameters:
      temperature: 0.1
      max_tokens: 4000
      top_p: 0.8
      top_k: 40
      candidate_count: 1
    
    # 任务类型特定参数
    task_parameters:
      coding:
        temperature: 0.05
        max_tokens: 6000
      review:
        temperature: 0.1
        max_tokens: 3000
      requirement_review:
        temperature: 0.15
        max_tokens: 5000
  
  cursor:
    api_key: "${CURSOR_API_KEY}"
    base_url: "https://api.cursor.sh"
    model: "cursor-1"
    max_tokens: 4000
    temperature: 0.1
    
    # 高级参数
    parameters:
      temperature: 0.1
      max_tokens: 4000
      top_p: 0.9
      frequency_penalty: 0.0
      presence_penalty: 0.0
    
    # 任务类型特定参数
    task_parameters:
      coding:
        temperature: 0.05
        max_tokens: 6000
      review:
        temperature: 0.1
        max_tokens: 3000
      requirement_review:
        temperature: 0.15
        max_tokens: 5000

# Git配置
git:
  default: "${DEFAULT_GIT_SERVICE}"  # 默认Git平台
  github:
    token: "${GITHUB_TOKEN}"
    username: "${GITHUB_USERNAME}"
  gitlab:
    token: "${GITLAB_TOKEN}"
    base_url: "${GITLAB_BASE_URL}"
    username: "${GITLAB_USERNAME}"  # 添加用户名配置

# 编码规范配置（按语言分类）
coding_standards:
  java:
    file_path: "./standards/java_coding_standards.md"
    enabled: true
    description: "Java编码规范"
    version: "1.0"
    last_updated: "2025-01-20"
  
  python:
    file_path: "./standards/python_coding_standards.md"
    enabled: true
    description: "Python编码规范"
    version: "1.0"
    last_updated: "2025-01-20"
  
  frontend:
    file_path: "./standards/frontend_coding_standards.md"
    enabled: true
    description: "前端编码规范"
    version: "1.0"
    last_updated: "2025-01-20"
  
  general:
    file_path: "./standards/general_coding_standards.md"
    enabled: true
    description: "通用编码规范"
    version: "1.0"
    last_updated: "2025-01-20"
  
  redlines:
    file_path: "./standards/redline_standards.md"
    enabled: true
    description: "编码红线规范"
    version: "1.0"
    last_updated: "2025-01-20"

# 任务超时时间配置
task_timeouts:
  coding: 1800      # 30分钟
  review: 900       # 15分钟
  doc: 600          # 10分钟
  requirement_review: 1200  # 20分钟
  custom: 1800      # 30分钟
  
  global:
    default: 600    # 默认超时时间
    max: 7200       # 最大超时时间（2小时）
    warning_threshold: 0.8  # 超时警告阈值

# 重试配置
retry_config:
  max_attempts: 3
  base_delay: 60
  max_delay: 3600
  backoff_multiplier: 2
  jitter: 0.1
  
  task_specific:
    coding:
      max_attempts: 5
      base_delay: 120
    git_operations:
      max_attempts: 3
      base_delay: 30

# 状态文件管理配置
state_management:
  cleanup_enabled: true
  retention_days: 90
  archive_enabled: true
  archive_path: "./archives/states"
  cleanup_schedule: "0 2 * * *"  # 每天凌晨2点清理
  
  cleanup_strategy:
    completed_tasks: "archive"
    failed_tasks: "archive"
    running_tasks: "skip"
    expired_tasks: "delete"
  
  archive:
    compression: true
    compression_format: "zip"
    max_archive_size: "100MB"
    archive_retention_days: 365
  
  state_file:
    max_size: "10MB"
    backup_enabled: true
    backup_count: 3
    backup_interval: "1h"

# 通知模板配置
notification_templates:
  variables:
    task_name: "{task_name}"
    task_type: "{task_type}"
    task_id: "{task_id}"
    duration: "{duration}"
    error_message: "{error_message}"
    files_count: "{files_count}"
    issues_count: "{issues_count}"
    inconsistencies_count: "{inconsistencies_count}"
  
  common:
    task_start: "🚀 任务 {task_name} ({task_type}) 开始执行"
    task_complete: "✅ 任务 {task_name} 执行完成，耗时 {duration}"
    task_error: "❌ 任务 {task_name} 执行失败: {error_message}"
  
  task_specific:
    coding:
      start: "🔧 编码任务 {task_name} 开始执行"
      complete: "✅ 编码任务 {task_name} 完成，生成了 {files_count} 个文件"
      error: "❌ 编码任务 {task_name} 失败: {error_message}"
      review_required: "🔍 编码任务 {task_name} 完成，等待代码审查"
    
    review:
      start: "🔍 代码审查任务 {task_name} 开始执行"
      complete: "✅ 代码审查完成，发现 {issues_count} 个问题"
      error: "❌ 代码审查失败: {error_message}"
      issues_found: "⚠️ 代码审查发现 {issues_count} 个问题，需要重新编码"
      no_issues: "✅ 代码审查通过，任务完成"
    
    doc:
      start: "📚 文档生成任务 {task_name} 开始执行"
      complete: "✅ 文档生成完成，输出到 {output_path}"
      error: "❌ 文档生成失败: {error_message}"
    
    requirement_review:
      start: "📋 需求评审任务 {task_name} 开始执行"
      complete: "✅ 需求评审完成，发现 {inconsistencies_count} 个不一致点"
      error: "❌ 需求评审失败: {error_message}"
      critical_issues: "🚨 需求评审发现关键问题，请及时处理"
    
    custom:
      start: "⚙️ 自定义任务 {task_name} 开始执行"
      complete: "✅ 自定义任务 {task_name} 执行完成"
      error: "❌ 自定义任务 {task_name} 执行失败: {error_message}"
  
  notification_levels:
    info: ["task_start", "task_complete"]
    warning: ["review_required", "issues_found"]
    error: ["task_error", "critical_issues"]
  
  channels:
    dingtalk:
      enabled: false
      webhook_url: "${DINGTALK_WEBHOOK}"
      secret: "${DINGTALK_SECRET}"
      at_users: ["张三", "李四"]
      at_all: false
    
    email:
      enabled: true
      smtp_server: "${EMAIL_SMTP_SERVER}"
      smtp_port: 587
      username: "${EMAIL_USERNAME}"
      password: "${EMAIL_PASSWORD}"
      from_email: "${EMAIL_FROM_EMAIL}"
      to_emails: ["${EMAIL_TO_EMAILS}"]
      use_tls: true
      use_ssl: false
    
    webhook:
      enabled: false
      url: ""
      headers: {}

# 通知配置
notification:
  dingtalk:
    webhook_url: "${DINGTALK_WEBHOOK}"
    secret: "${DINGTALK_SECRET}"
    at_users: ["张三", "李四"]
  
  email:
    smtp_server: "${EMAIL_SMTP_SERVER}"
    smtp_port: 587
    username: "${EMAIL_USERNAME}"
    password: "${EMAIL_PASSWORD}"
    from_email: "${EMAIL_FROM_EMAIL}"
    to_emails: ["${EMAIL_TO_EMAILS}"]
    use_tls: true
    use_ssl: false

# 日志配置
logging:
  level: "INFO"
  retention_days: 30
  max_file_size: "10MB"

# 系统配置
system:
  work_dir: "./states"
  output_dir: "./outputs"
  max_concurrent_tasks: 5
  default_timeout: 300

# 智能任务生成配置
intelligent_task_generation:
  enabled: true
  
  # 优化规则
  optimization_rules:
    coding:
      max_tokens_multiplier: 1.5
      temperature_adjustment: 0.8
      timeout_multiplier: 1.3
      retry_attempts_increase: 1
    
    review:
      max_tokens_multiplier: 1.2
      temperature_adjustment: 0.9
      timeout_multiplier: 1.1
      retry_attempts_increase: 0
    
    doc:
      max_tokens_multiplier: 1.8
      temperature_adjustment: 0.7
      timeout_multiplier: 1.5
      retry_attempts_increase: 1
    
    requirement_review:
      max_tokens_multiplier: 1.6
      temperature_adjustment: 0.8
      timeout_multiplier: 1.4
      retry_attempts_increase: 1
    
    custom:
      max_tokens_multiplier: 1.3
      temperature_adjustment: 0.9
      timeout_multiplier: 1.2
      retry_attempts_increase: 0
  
  # 模板管理
  template_management:
    auto_learn: true
    template_retention_days: 365
    min_usage_count: 3
    success_rate_threshold: 0.7
  
  # 预测配置
  prediction:
    use_historical_data: true
    confidence_threshold: 0.6
    max_prediction_history: 1000
    prediction_accuracy_tracking: true

# AI模型管理配置
ai_model_management:
  enabled: true
  
  # 数据库配置
  database_path: "./data/ai_models.db"
  models_directory: "./models"
  
  # 性能监控配置
  performance_history_size: 1000
  performance_window_hours: 24
  
  # 自动切换配置
  auto_switch_enabled: true
  auto_switch_threshold: 0.8
  
  # 模型类型配置
  supported_model_types:
    - "text_generation"
    - "code_generation"
    - "text_analysis"
    - "multimodal"
    - "embedding"
  
  # 默认模型配置
  default_models:
    text_generation:
      model_name: "claude-3-sonnet"
      version: "20240229"
      provider: "anthropic"
      parameters:
        max_tokens: 4000
        temperature: 0.7
    
    code_generation:
      model_name: "claude-3-sonnet"
      version: "20240229"
      provider: "anthropic"
      parameters:
        max_tokens: 6000
        temperature: 0.3
    
    text_analysis:
      model_name: "claude-3-haiku"
      version: "20240307"
      provider: "anthropic"
      parameters:
        max_tokens: 2000
        temperature: 0.5

# 多模态AI支持配置
multimodal_ai:
  enabled: true
  
  # 支持的媒体类型
  supported_media_types:
    - "image"
    - "pdf"
    - "word"
    - "text"
  
  # 输出目录
  output_directory: "./outputs/multimodal"
  
  # 图像处理配置
  image_processing:
    max_image_size: 10  # MB
    supported_formats:
      - "jpg"
      - "jpeg"
      - "png"
      - "gif"
      - "bmp"
      - "tiff"
      - "webp"
    enhancement_options:
      brightness_factor: 1.2
      contrast_factor: 1.5
      sharpness_factor: 2.0
  
  # 文档处理配置
  document_processing:
    max_file_size: 50  # MB
    supported_formats:
      pdf: [".pdf"]
      word: [".docx", ".doc"]
      text: [".txt", ".md", ".json", ".xml", ".csv"]
    extraction_options:
      extract_tables: true
      extract_images: false
      preserve_formatting: true
  
  # AI分析配置
  ai_analysis:
    default_prompt: "请分析这个媒体文件的内容和特征"
    max_tokens: 1000
    temperature: 0.3
    use_ai_for_all_types: true
  
  # 性能配置
  performance:
    max_concurrent_processes: 3
    timeout_per_file: 300  # 秒
    memory_limit: "2GB"

# 机器学习集成配置
machine_learning:
  enabled: true
  
  # 数据库配置
  database_path: "./data/ml_service.db"
  models_directory: "./models"
  
  # 预测模型配置
  prediction:
    min_training_samples: 10
    model_type: "random_forest"
    n_estimators: 100
    random_state: 42
    confidence_threshold: 0.7
    prediction_window_days: 90
  
  # 异常检测配置
  anomaly_detection:
    enabled: true
    detection_method: "statistical"
    duration_threshold: 2.0  # 标准差倍数
    error_threshold: 2.0
    retry_threshold: 3
    min_samples_for_detection: 10
  
  # 智能调度配置
  scheduling:
    enabled: true
    optimization_algorithm: "genetic"
    population_size: 50
    generations: 100
    mutation_rate: 0.1
    crossover_rate: 0.8
  
  # A/B测试配置
  ab_testing:
    enabled: true
    min_sample_size: 100
    confidence_level: 0.95
    max_test_duration_days: 30
    traffic_allocation_method: "hash_based"
    result_storage_days: 90
  
  # 模型管理配置
  model_management:
    auto_save_interval_hours: 24
    model_versioning: true
    backup_models: true
    model_validation: true
  
  # 数据管理配置
  data_management:
    cleanup_interval_days: 7
    retention_days: 90
    max_database_size_mb: 1000
    compression_enabled: true
  
  # 性能配置
  performance:
    max_concurrent_predictions: 10
    batch_size: 100
    cache_size: 1000
    timeout_seconds: 300
