# 📧 邮件推送配置指南

## 🎯 概述

自动化AI任务执行系统现在支持邮件推送功能，可以通过SMTP服务器发送任务执行通知。

## ⚙️ 配置步骤

### 1. 设置环境变量

在系统环境变量中设置以下邮件相关配置：

```bash
# 邮件服务器配置
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_USERNAME=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
EMAIL_FROM_EMAIL=your-email@gmail.com
EMAIL_TO_EMAILS=admin@company.com,user1@company.com
```

### 2. 常用邮件服务商配置

#### Gmail配置
```bash
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=your-email@gmail.com
EMAIL_PASSWORD=your-app-password  # 使用应用专用密码
EMAIL_FROM_EMAIL=your-email@gmail.com
EMAIL_TO_EMAILS=admin@company.com
```

#### QQ邮箱配置
```bash
EMAIL_SMTP_SERVER=smtp.qq.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=your-qq@qq.com
EMAIL_PASSWORD=your-authorization-code  # 使用授权码
EMAIL_FROM_EMAIL=your-qq@qq.com
EMAIL_TO_EMAILS=admin@company.com
```

#### 163邮箱配置
```bash
EMAIL_SMTP_SERVER=smtp.163.com
EMAIL_SMTP_PORT=25
EMAIL_USERNAME=your-163@163.com
EMAIL_PASSWORD=your-authorization-code  # 使用授权码
EMAIL_FROM_EMAIL=your-163@163.com
EMAIL_TO_EMAILS=admin@company.com
```

#### 企业邮箱配置
```bash
EMAIL_SMTP_SERVER=smtp.company.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=your-name@company.com
EMAIL_PASSWORD=your-password
EMAIL_FROM_EMAIL=your-name@company.com
EMAIL_TO_EMAILS=admin@company.com
```

### 3. 配置文件设置

在 `config/global_config.yaml` 中确认邮件配置：

```yaml
notification_templates:
  channels:
    email:
      enabled: true
      smtp_server: "${EMAIL_SMTP_SERVER}"
      smtp_port: 587
      username: "${EMAIL_USERNAME}"
      password: "${EMAIL_PASSWORD}"
      from_email: "${EMAIL_FROM_EMAIL}"
      to_emails: ["${EMAIL_TO_EMAILS}"]
      use_tls: true
      use_ssl: false

notification:
  email:
    smtp_server: "${EMAIL_SMTP_SERVER}"
    smtp_port: 587
    username: "${EMAIL_USERNAME}"
    password: "${EMAIL_PASSWORD}"
    from_email: "${EMAIL_FROM_EMAIL}"
    to_emails: ["${EMAIL_TO_EMAILS}"]
    use_tls: true
    use_ssl: false
```

## 🔧 功能特性

### 1. 支持的邮件格式
- **HTML格式**: 美观的邮件界面，支持样式和emoji
- **纯文本格式**: 兼容性更好的纯文本版本
- **多部分邮件**: 同时发送HTML和纯文本版本

### 2. 通知级别
- **📢 信息级别**: 任务开始、完成等正常状态
- **⚠️ 警告级别**: 需要关注的问题
- **🚨 错误级别**: 严重错误和异常

### 3. 邮件内容
- 任务执行状态
- 执行时间统计
- 错误信息详情
- 系统时间戳
- 任务ID和类型

## 🧪 测试邮件发送

### 1. 使用系统测试
```bash
python test_system.py
```

### 2. 测试通知服务
```bash
python src/cli/main.py status
```

### 3. 手动测试邮件发送
```python
from src.services.notify_service import EmailNotifier

# 创建邮件配置
email_config = {
    'smtp_server': 'smtp.gmail.com',
    'smtp_port': 587,
    'username': 'your-email@gmail.com',
    'password': 'your-app-password',
    'from_email': 'your-email@gmail.com',
    'to_emails': ['admin@company.com'],
    'use_tls': True,
    'use_ssl': False
}

# 创建邮件通知器
email_notifier = EmailNotifier(email_config)

# 发送测试邮件
email_notifier.send(
    message="🚀 Auto-Coder系统邮件推送测试",
    level="info",
    variables={
        'task_id': 'TEST_001',
        'task_type': 'test',
        'duration': '1分钟'
    }
)
```

## 🔒 安全注意事项

### 1. 密码安全
- ⚠️ **不要**在代码中硬编码邮箱密码
- ⚠️ **不要**将密码提交到Git仓库
- ✅ 使用环境变量管理敏感信息
- ✅ 使用应用专用密码或授权码

### 2. 权限控制
- 只给必要的用户发送通知
- 避免发送敏感信息
- 定期审查邮件发送记录

### 3. 频率限制
- 避免邮件轰炸
- 合理设置通知频率
- 监控邮件发送量

## 🚨 常见问题

### Q: 邮件发送失败怎么办？
A: 
1. 检查网络连接
2. 验证SMTP服务器配置
3. 确认用户名和密码正确
4. 检查防火墙设置
5. 查看系统日志获取详细错误信息

### Q: Gmail需要什么特殊配置？
A: 
1. 开启两步验证
2. 生成应用专用密码
3. 使用应用专用密码而不是账户密码

### Q: 企业邮箱配置有什么要求？
A: 
1. 确认SMTP服务器地址和端口
2. 可能需要特殊的认证方式
3. 联系IT部门获取正确的配置信息

### Q: 如何设置多个收件人？
A: 
```bash
EMAIL_TO_EMAILS=admin@company.com,user1@company.com,user2@company.com
```

## 📊 最佳实践

1. **邮件设计**: 使用清晰的标题和结构化的内容
2. **频率控制**: 避免过度发送邮件
3. **内容优化**: 提供有用的信息和操作指引
4. **监控告警**: 监控邮件发送成功率和失败情况
5. **备份方案**: 配置多个通知渠道作为备份

## 📞 获取帮助

如果遇到问题，可以：
- 查看系统日志文件
- 检查邮件服务器配置
- 联系邮件服务商技术支持
- 提交Issue获取帮助
