---
title: "Python编码规范 v1.0"
version: "1.0"
last_updated: "2025-01-20"
language: "python"
framework: "django/flask"
---

# Python编码规范 v1.0

## 命名规范

### 类名
- 使用PascalCase，如 `UserService`、`OrderController`
- 异常类以 `Error` 结尾，如 `ValidationError`
- 测试类以 `Test` 开头，如 `TestUserService`

### 函数和变量名
- 使用snake_case，如 `get_user_by_id`、`user_name`
- 常量使用UPPER_SNAKE_CASE，如 `MAX_RETRY_COUNT`
- 私有方法以下划线开头，如 `_internal_method`

### 模块和包名
- 使用小写字母，如 `user_service`、`order_controller`
- 避免使用下划线或连字符
- 包名应该是有效的Python标识符

## 代码结构

### 导入顺序
1. 标准库导入
2. 第三方库导入
3. 本地应用导入
4. 每组之间空一行

### 函数设计
- 单个函数不超过50行
- 函数参数不超过5个
- 单一职责原则：一个函数只做一件事
- 使用类型提示（Python 3.6+）

### 类设计
- 单个类不超过500行
- 遵循单一职责原则
- 优先使用组合而非继承
- 使用 `__slots__` 优化内存（适用时）

## 异常处理

### 异常捕获
- 使用具体的异常类型，避免捕获通用Exception
- 记录详细的错误日志，包含上下文信息
- 使用 `logging` 模块记录异常

### 异常抛出
- 使用有意义的异常消息
- 包含必要的上下文信息
- 自定义异常继承自 `Exception`

## 性能规范

### 数据结构
- 使用列表推导式而非循环
- 优先使用 `set` 进行成员检查
- 使用 `collections.defaultdict` 简化代码

### 字符串处理
- 使用 `join()` 进行字符串拼接
- 避免在循环中创建字符串对象
- 使用 `f-strings`（Python 3.6+）

### 文件操作
- 使用 `with` 语句自动关闭文件
- 使用 `pathlib` 处理路径（Python 3.4+）
- 合理使用文件缓冲

## 红线规范

### 禁止使用
- 禁止使用 `print()` 输出日志
- 禁止使用 `eval()` 执行字符串
- 禁止使用 `exec()` 执行代码
- 禁止使用全局变量存储状态

### 必须遵循
- 必须使用日志框架记录日志
- 必须处理所有可能的异常
- 必须验证输入参数
- 必须使用虚拟环境管理依赖

## 日志规范

### 日志级别
- ERROR：系统错误，需要立即处理
- WARN：警告信息，可能存在问题
- INFO：一般信息，记录重要操作
- DEBUG：调试信息，开发时使用

### 日志内容
- 包含操作类型和结果
- 包含关键参数信息
- 包含执行时间（重要操作）
- 包含错误堆栈（异常情况）

## 测试规范

### 单元测试
- 使用 `pytest` 框架
- 测试覆盖率不低于80%
- 每个公共函数都要有测试
- 使用有意义的测试函数名

### 测试数据
- 测试数据要独立，避免相互影响
- 使用 `pytest.fixture` 管理测试数据
- 测试完成后清理数据
- 使用 `pytest.mark` 标记测试类型

## 代码质量

### 代码检查
- 使用 `flake8` 检查代码风格
- 使用 `black` 格式化代码
- 使用 `isort` 排序导入
- 使用 `mypy` 进行类型检查

### 文档规范
- 使用docstring记录函数和类
- 遵循Google或NumPy文档风格
- 包含参数、返回值和异常说明
- 提供使用示例
