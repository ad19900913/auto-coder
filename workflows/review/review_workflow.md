# Review任务工作流程规范

## 概述
Review任务工作流基于基础模板扩展，专门用于AI驱动的代码走查和质量审查任务。该工作流支持独立走查和协作走查两种模式，包含完整的审查周期：范围分析、代码分析、架构审查、安全检查、性能审查、兼容性检查和报告生成。

## 工作流程

### 1. 走查范围分析和任务初始化 (init)
- **目的**：分析走查范围，制定审查计划
- **AI提示词**：使用 `review_init_prompt` 模板
- **输出**：走查范围表格，包含文件/模块、走查类型、优先级等
- **审批要求**：无需人工审批

### 2. 走查范围选择 (select_scope)
- **目的**：交互式选择具体的走查范围和类型
- **执行方式**：支持快捷指令选择
- **输出**：确定的走查范围和优先级
- **审批要求**：需要人工确认走查范围
- **支持命令**：
  - `继续` - 选择所有范围
  - `默认顺序` - 按优先级顺序执行
  - `选择序号X,Y` - 批量选择特定范围
  - `跳过序号X,Y` - 跳过指定范围

### 3. 代码结构和质量分析 (code_analysis)
- **目的**：深入分析代码结构、质量和规范性
- **AI提示词**：使用 `review_code_analysis_prompt` 模板
- **输出**：代码分析报告
- **DoD检查**：代码质量评分、关键问题数量

### 4. 架构设计审查 (architecture_review)
- **目的**：审查系统架构设计的合理性
- **AI提示词**：使用 `review_architecture_prompt` 模板
- **输出**：架构审查报告
- **DoD检查**：架构一致性、接口设计合理性

### 5. 安全性审查 (security_review)
- **目的**：检查代码的安全漏洞和防护措施
- **AI提示词**：使用 `review_security_prompt` 模板
- **输出**：安全审查报告
- **DoD检查**：安全漏洞数量、权限控制检查

### 6. 性能审查 (performance_review)
- **目的**：分析性能瓶颈和优化机会
- **AI提示词**：使用 `review_performance_prompt` 模板
- **输出**：性能审查报告
- **DoD检查**：性能瓶颈识别、优化建议可行性

### 7. 兼容性检查 (compatibility_check)
- **目的**：检查向后兼容性和接口兼容性
- **AI提示词**：使用 `review_compatibility_prompt` 模板
- **输出**：兼容性检查报告
- **DoD检查**：兼容性风险评估

### 8. 生成走查报告 (generate_report)
- **目的**：汇总所有审查结果，生成综合报告
- **AI提示词**：使用 `review_report_prompt` 模板
- **输出**：完整的Markdown格式走查报告
- **DoD检查**：报告完整性、建议可执行性

### 9. 报告发布前人工审批 (approval_before_publish)
- **目的**：在发布报告前进行人工审查
- **执行方式**：暂停等待人工确认
- **输出**：审批状态和意见
- **审批要求**：必须人工审批
- **超时设置**：1小时

### 10. 发布走查报告 (publish_report)
- **目的**：将报告发布到指定位置
- **执行方式**：文件操作
- **输出**：已发布的报告文件
- **审批要求**：无需人工审批

### 11. 通知相关人员 (notify_stakeholders)
- **目的**：通知项目相关人员走查完成
- **执行方式**：发送通知
- **输出**：通知发送状态
- **审批要求**：无需人工审批

### 12. 走查任务完成总结 (finalize)
- **目的**：生成任务完成报告
- **AI提示词**：使用 `review_finalize_prompt` 模板
- **输出**：完成总结报告

## 走查类型

### 代码质量走查
- **代码结构分析**：模块组织、类设计、方法结构
- **设计模式检查**：设计模式使用的正确性和适用性
- **代码复杂度评估**：圈复杂度、认知复杂度分析
- **命名规范检查**：变量、方法、类的命名规范性
- **注释完整性**：代码注释的完整性和准确性

### 架构设计审查
- **模块化设计**：模块划分的合理性和职责清晰度
- **依赖关系**：模块间依赖的合理性和循环依赖检查
- **接口定义**：API接口设计的一致性和易用性
- **数据流设计**：数据流向的清晰性和合理性
- **扩展性考虑**：系统的可扩展性和可维护性

### 安全性审查
- **输入验证**：用户输入的验证和过滤机制
- **权限控制**：访问控制和权限验证机制
- **数据加密**：敏感数据的加密和保护
- **SQL注入防护**：数据库查询的安全性
- **XSS防护**：跨站脚本攻击的防护机制

### 性能审查
- **算法复杂度**：算法效率和时间复杂度分析
- **数据库查询优化**：SQL查询的优化和索引使用
- **缓存策略**：缓存的使用和缓存策略合理性
- **资源使用**：内存、CPU等资源的使用效率
- **并发处理**：并发安全和性能考虑

### 兼容性检查
- **向后兼容**：新版本对旧版本的兼容性
- **API兼容**：接口变更的兼容性影响
- **数据库兼容**：数据库结构变更的兼容性
- **版本兼容**：不同版本间的兼容性
- **环境兼容**：不同部署环境的兼容性

## 协作模式

### 独立走查模式
- **适用场景**：定期代码审查、历史代码走查
- **数据来源**：Git仓库、分支历史、提交记录
- **走查范围**：任意分支、提交历史范围

### 协作走查模式
- **适用场景**：配合编码任务的走查
- **数据来源**：编码任务的输出产物
- **共享数据**：
  - 实现计划文档
  - 代码变更记录
  - 提交记录
  - 测试结果

## DoD验证规则

### 代码分析验证
- 代码质量评分 ≥ 8.0
- 关键问题数量 ≤ 5
- 安全风险等级 ≤ Medium

### 架构审查验证
- 架构一致性检查通过
- 接口设计合理性确认
- 依赖关系清晰

### 安全审查验证
- 安全漏洞数量 = 0
- 权限控制检查通过
- 数据保护措施完备

### 性能审查验证
- 性能瓶颈识别完成
- 优化建议具体可行
- 资源使用合理

### 报告生成验证
- 报告内容完整
- 建议具体可执行
- 风险评估准确

## 配置选项

### 工作流特定配置
- `independent_mode`: 是否启用独立走查模式
- `collaborative_mode`: 是否启用协作走查模式
- `multi_branch_support`: 是否支持多分支对比
- `commit_history_analysis`: 是否启用提交历史分析
- `quality_metrics`: 是否启用质量指标分析

### 步骤级配置
每个步骤都可以配置：
- `pause_for_approval`: 是否暂停等待审批
- `dod_check`: 是否执行DoD验证
- `timeout`: 步骤超时时间
- 特定步骤的配置参数

## 产物输出

### 主要产物
- 代码分析报告
- 架构审查报告
- 安全审查报告
- 性能审查报告
- 兼容性检查报告
- 综合走查报告
- 任务完成报告

### 产物命名
所有产物按照 `{task_id}/{timestamp}/{step_name}` 的格式命名，确保唯一性和可追溯性。

## 扩展和定制

### 步骤覆盖
- 可以禁用不需要的审查类型
- 可以修改步骤的配置参数
- 可以调整DoD验证规则

### 模板定制
- 可以修改AI提示词模板
- 可以调整审查重点和标准
- 可以自定义报告格式和内容
