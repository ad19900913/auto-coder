# 需求评审任务工作流程规范

## 概述
需求评审任务工作流基于基础模板扩展，专门用于AI驱动的需求文档与代码实现一致性分析。该工作流通过多维度评审，深入分析需求与实现的匹配程度，识别差距和风险，为项目质量提供保障。

## 工作流程

### 1. 需求评审初始化和范围分析 (init)
- **目的**：初始化评审任务，分析评审范围和维度
- **AI提示词**：使用 `req_review_init_prompt` 模板
- **输出**：评审维度表格，包含评审内容、方法、指标等
- **审批要求**：无需人工审批
- **表格格式**：
  | 序号 | 评审维度 | 评审内容 | 评审方法 | 预估时间 | 关键指标 | 风险等级 | 验收标准 |
  |------|----------|----------|----------|----------|----------|----------|----------|

### 2. 评审维度选择 (select_dimensions)
- **目的**：交互式选择具体的评审维度和重点
- **执行方式**：支持快捷指令选择
- **输出**：确定的评审维度和优先级
- **审批要求**：需要人工确认评审范围
- **支持命令**：
  - `继续` - 选择所有维度
  - `默认顺序` - 按重要性顺序执行
  - `选择序号X,Y` - 批量选择特定维度
  - `跳过序号X,Y` - 跳过指定维度
- **评审维度**：
  - 架构一致性
  - 接口匹配性
  - 数据模型一致性
  - 功能完整性
  - 性能需求匹配
  - 安全需求实现

### 3. 需求文档分析 (requirement_analysis)
- **目的**：深入分析需求文档，提取关键信息
- **AI提示词**：使用 `req_analysis_prompt` 模板
- **输出**：结构化的需求分析报告
- **DoD检查**：需求提取完整性、分类准确性
- **分析维度**：
  - 功能需求提取
  - 非功能需求识别
  - 接口需求分析
  - 数据需求分析
  - 约束条件梳理
  - 验收条件提取

### 4. 代码范围分析 (code_scope_analysis)
- **目的**：分析指定代码范围，识别实现结构
- **AI提示词**：使用 `code_scope_analysis_prompt` 模板
- **输出**：代码结构分析报告
- **DoD检查**：代码覆盖率、关键模块识别完整性
- **分析范围**：
  - 项目结构分析
  - 模块划分识别
  - 接口定义提取
  - 数据模型识别
  - 配置文件分析

### 5. 架构一致性评审 (architecture_consistency)
- **目的**：对比需求与实现的架构设计一致性
- **AI提示词**：使用 `architecture_consistency_prompt` 模板
- **输出**：架构一致性分析报告
- **DoD检查**：一致性匹配度、差异识别完整性
- **对比维度**：
  - 系统架构对比
  - 模块划分一致性
  - 组件依赖关系
  - 技术栈匹配性
  - 设计模式应用

### 6. 接口匹配性评审 (interface_matching)
- **目的**：检查API接口与需求规范的匹配程度
- **AI提示词**：使用 `interface_matching_prompt` 模板
- **输出**：接口匹配性分析报告
- **DoD检查**：接口识别准确性、匹配度评估
- **匹配检查**：
  - API接口对比
  - 参数结构匹配
  - 返回格式一致性
  - 错误处理机制
  - 认证授权方式

### 7. 数据模型一致性评审 (data_model_consistency)
- **目的**：评审数据模型与需求的一致性
- **AI提示词**：使用 `data_model_consistency_prompt` 模板
- **输出**：数据模型一致性报告
- **DoD检查**：数据实体匹配度、关系约束检查
- **数据维度**：
  - 数据实体对比
  - 字段定义匹配
  - 关系约束检查
  - 数据流一致性
  - 存储方案匹配

### 8. 功能完整性评审 (functional_completeness)
- **目的**：评估功能实现的完整性和正确性
- **AI提示词**：使用 `functional_completeness_prompt` 模板
- **输出**：功能完整性评审报告
- **DoD检查**：功能覆盖完整性、业务逻辑正确性
- **完整性检查**：
  - 核心功能覆盖
  - 边界场景处理
  - 异常情况处理
  - 业务规则实现
  - 用户体验一致性

### 9. 性能需求匹配评审 (performance_requirements)
- **目的**：检查性能实现与需求指标的匹配
- **AI提示词**：使用 `performance_requirements_prompt` 模板
- **输出**：性能需求匹配报告
- **DoD检查**：性能指标识别、实现方案评估
- **性能维度**：
  - 响应时间要求
  - 并发处理能力
  - 吞吐量指标
  - 资源使用限制
  - 扩展性设计

### 10. 安全需求实现评审 (security_requirements)
- **目的**：评审安全需求的实现情况
- **AI提示词**：使用 `security_requirements_prompt` 模板
- **输出**：安全需求实现报告
- **DoD检查**：安全措施识别、合规性检查
- **安全维度**：
  - 认证机制实现
  - 授权控制方式
  - 数据加密处理
  - 安全防护措施
  - 合规性要求

### 11. 差距分析和风险评估 (gap_analysis)
- **目的**：综合分析需求与实现的差距，评估风险
- **AI提示词**：使用 `gap_analysis_prompt` 模板
- **输出**：差距分析和风险评估报告
- **DoD检查**：差距识别完整性、风险评估准确性
- **分析输出**：
  - 需求实现差距
  - 功能缺失分析
  - 设计偏差识别
  - 风险等级评估
  - 改进建议

### 12. 生成评审报告 (generate_report)
- **目的**：汇总所有评审结果，生成综合报告
- **AI提示词**：使用 `req_review_report_prompt` 模板
- **输出**：完整的Markdown格式评审报告
- **DoD检查**：报告完整性、结论支撑充分性
- **报告章节**：
  - 评审摘要
  - 一致性分析
  - 差距识别
  - 风险评估
  - 改进建议
  - 后续行动

### 13. 报告发布前人工审批 (approval_before_publish)
- **目的**：在发布报告前进行人工审查
- **执行方式**：暂停等待人工确认
- **输出**：审批状态和意见
- **审批要求**：必须人工审批
- **超时设置**：1小时

### 14. 发布评审报告 (publish_report)
- **目的**：将评审报告发布到指定位置
- **执行方式**：文件操作
- **输出**：已发布的报告文件
- **审批要求**：无需人工审批

### 15. 通知相关人员 (notify_stakeholders)
- **目的**：通知项目相关人员评审完成
- **执行方式**：发送高优先级通知
- **输出**：通知发送状态
- **审批要求**：无需人工审批

### 16. 需求评审任务完成总结 (finalize)
- **目的**：生成任务完成报告
- **AI提示词**：使用 `req_review_finalize_prompt` 模板
- **输出**：完成总结报告

## 评审维度权重配置

### 架构一致性 (25% 权重)
- **权重**：25%
- **关键性**：关键
- **评审方面**：
  - 系统架构
  - 模块设计
  - 技术选型
  - 集成方案

### 接口匹配性 (20% 权重)
- **权重**：20%
- **关键性**：关键
- **评审方面**：
  - API设计
  - 数据格式
  - 协议规范
  - 版本兼容

### 数据模型一致性 (20% 权重)
- **权重**：20%
- **关键性**：关键
- **评审方面**：
  - 数据结构
  - 关系设计
  - 约束规则
  - 存储方案

### 功能完整性 (20% 权重)
- **权重**：20%
- **关键性**：关键
- **评审方面**：
  - 功能覆盖
  - 业务逻辑
  - 用户体验
  - 边界处理

### 性能需求匹配 (10% 权重)
- **权重**：10%
- **关键性**：重要
- **评审方面**：
  - 性能指标
  - 扩展性
  - 稳定性
  - 可用性

### 安全需求实现 (5% 权重)
- **权重**：5%
- **关键性**：重要
- **评审方面**：
  - 安全防护
  - 权限控制
  - 数据保护
  - 合规要求

## DoD验证规则

### 需求分析验证
- 需求提取完整性 ≥ 95%
- 需求分类准确性 ≥ 90%
- 关键需求识别率 = 100%

### 代码分析验证
- 代码覆盖率 ≥ 80%
- 关键模块分析完整
- 接口识别准确性 ≥ 95%

### 一致性检查验证
- 一致性匹配度 ≥ 85%
- 关键差异识别完整
- 风险评估准确性 ≥ 90%

### 差距分析验证
- 差距识别完整性 ≥ 90%
- 改进建议可执行性 ≥ 80%
- 风险等级评估准确

### 报告生成验证
- 报告内容完整性 = 100%
- 结论支撑充分性 ≥ 90%
- 建议具体可操作性 ≥ 85%

## 配置选项

### 工作流特定配置
- `document_analysis`: 是否启用需求文档分析
- `code_analysis`: 是否启用代码实现分析
- `consistency_check`: 是否启用一致性检查
- `gap_analysis`: 是否启用差距分析
- `risk_assessment`: 是否启用风险评估

### 评审范围配置
- **需求文档来源**：本地文件路径（Word/Markdown）
- **代码实现范围**：项目路径、包路径、类路径
- **评审深度**：基础、详细、深度
- **权重配置**：各维度的重要性权重

## 产物输出

### 主要产物
- 评审维度表格
- 需求分析报告
- 代码结构分析报告
- 架构一致性报告
- 接口匹配性报告
- 数据模型一致性报告
- 功能完整性报告
- 性能需求匹配报告
- 安全需求实现报告
- 差距分析和风险评估报告
- 综合评审报告
- 任务完成报告

### 产物命名
所有产物按照 `{task_id}/{timestamp}/{step_name}` 的格式命名，确保唯一性和可追溯性。

## 使用场景

### 1. 项目验收评审
- **场景**：项目交付前的需求符合性检查
- **重点**：功能完整性、接口一致性
- **产出**：验收报告、问题清单

### 2. 架构设计评审
- **场景**：系统架构与需求的匹配性分析
- **重点**：架构一致性、技术选型合理性
- **产出**：架构评审报告、优化建议

### 3. 接口规范检查
- **场景**：API实现与接口规范的一致性验证
- **重点**：接口匹配性、数据格式一致性
- **产出**：接口检查报告、差异清单

### 4. 系统升级评估
- **场景**：系统升级对需求实现的影响分析
- **重点**：变更影响、兼容性问题
- **产出**：影响评估报告、风险分析

## 扩展和定制

### 评审维度扩展
- 可以添加新的评审维度
- 调整各维度的权重配置
- 定制特定的评审标准

### 分析深度定制
- 可以配置不同的分析深度级别
- 调整AI提示词的详细程度
- 定制特定领域的分析重点

### 报告格式定制
- 可以修改报告的章节结构
- 调整输出格式和样式
- 定制特定的评审模板

## 最佳实践

### 1. 需求文档准备
- 确保需求文档的完整性和准确性
- 使用标准化的需求描述格式
- 包含明确的验收标准
- 维护需求的可追溯性

### 2. 代码范围界定
- 明确评审的代码范围边界
- 排除与需求无关的代码部分
- 关注核心业务逻辑的实现
- 包含配置和部署相关代码

### 3. 评审重点设定
- 根据项目特点调整评审重点
- 关注高风险和关键功能
- 平衡评审深度和效率
- 考虑项目阶段和时间约束

### 4. 结果应用
- 及时跟进评审发现的问题
- 建立问题整改的闭环机制
- 将评审结果纳入质量度量
- 持续优化评审流程和标准
