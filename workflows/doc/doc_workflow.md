# 文档生成任务工作流程规范

## 概述
文档生成任务工作流基于基础模板扩展，专门用于AI驱动的文档自动生成。该工作流支持多种文档类型、多格式输出、模板驱动生成，包含完整的文档创建周期：需求分析、章节规划、数据收集、内容生成、图表制作、格式转换和发布。

## 工作流程

### 1. 文档需求分析和结构规划 (init)
- **目的**：分析文档需求，规划文档结构和章节
- **AI提示词**：使用 `doc_init_prompt` 模板
- **输出**：文档结构表格，包含章节、内容类型、详细程度等
- **审批要求**：无需人工审批
- **表格格式**：
  | 序号 | 文档章节 | 内容类型 | 详细程度 | 预估页数 | 数据来源 | 优先级 | 依赖关系 |
  |------|----------|----------|----------|----------|----------|--------|----------|

### 2. 文档章节选择 (select_sections)
- **目的**：交互式选择要生成的文档章节
- **执行方式**：支持快捷指令选择
- **输出**：确定的章节列表和生成顺序
- **审批要求**：需要人工确认章节选择
- **支持命令**：
  - `继续` - 生成所有章节
  - `默认顺序` - 按逻辑顺序生成
  - `选择序号X,Y` - 批量选择特定章节
  - `跳过序号X,Y` - 跳过指定章节
- **章节类型**：
  - 概述说明
  - 技术规范
  - API文档
  - 用户指南
  - 操作手册
  - 架构设计

### 3. 数据收集和预处理 (data_collection)
- **目的**：收集文档生成所需的各种数据源
- **执行方式**：自动化数据采集和处理
- **输出**：结构化的数据集合
- **DoD检查**：数据完整性、有效性验证
- **数据来源**：
  - 代码库分析
  - 配置文件扫描
  - API接口提取
  - 数据库结构
  - 现有文档整理
- **收集方法**：
  - 静态分析
  - 动态扫描
  - 文件解析
  - Git历史分析

### 4. 文档大纲生成 (outline_generation)
- **目的**：生成详细的文档大纲和章节结构
- **AI提示词**：使用 `doc_outline_prompt` 模板
- **输出**：层次化的文档大纲
- **审批要求**：需要人工确认大纲结构
- **DoD检查**：大纲逻辑性、完整性验证

### 5. 文档内容生成 (content_generation)
- **目的**：根据大纲和数据生成具体的文档内容
- **AI提示词**：使用 `doc_content_prompt` 模板
- **输出**：完整的文档内容
- **DoD检查**：内容准确性、示例代码可执行性
- **生成特性**：
  - 按章节逐步生成
  - 包含实际示例
  - 集成图表和图形

### 6. 图表和图形生成 (diagram_generation)
- **目的**：为文档生成配套的图表和图形
- **AI提示词**：使用 `doc_diagram_prompt` 模板
- **输出**：Mermaid格式的各类图表
- **DoD检查**：图表语法正确性、信息完整性
- **图表类型**：
  - 架构图
  - 流程图
  - 时序图
  - 类图
  - 部署图

### 7. 代码示例生成 (code_sample_generation)
- **目的**：生成文档中的代码示例和使用案例
- **AI提示词**：使用 `doc_code_sample_prompt` 模板
- **输出**：多语言的代码示例
- **DoD检查**：代码示例可执行性、完整性
- **示例类型**：
  - API调用示例
  - 配置示例
  - 使用案例
  - 集成示例
- **支持语言**：Java, Python, JavaScript, Curl, YAML

### 8. 文档审查和优化 (review_and_optimize)
- **目的**：审查文档质量并进行优化
- **AI提示词**：使用 `doc_review_prompt` 模板
- **输出**：优化后的文档内容
- **DoD检查**：内容质量评估、用户友好性检查
- **审查维度**：
  - 内容完整性
  - 逻辑一致性
  - 表达清晰度
  - 格式规范性
  - 用户友好性

### 9. 格式转换和美化 (format_conversion)
- **目的**：将文档转换为多种目标格式
- **执行方式**：自动化格式处理
- **输出**：多格式的文档文件
- **DoD检查**：格式转换成功率、排版效果
- **支持格式**：
  - PDF - 专业排版
  - HTML - 在线浏览
  - DOCX - Office兼容
  - Confluence - 企业协作
- **美化功能**：
  - 目录生成
  - 页码添加
  - 图表美化
  - 代码高亮

### 10. 文档发布前人工审批 (approval_before_publish)
- **目的**：在发布前进行最终审查
- **执行方式**：暂停等待人工确认
- **输出**：审批状态和意见
- **审批要求**：必须人工审批
- **超时设置**：2小时
- **预览功能**：支持多格式预览

### 11. 发布文档 (publish_document)
- **目的**：将文档发布到指定位置
- **执行方式**：文件操作和版本控制
- **输出**：已发布的文档文件
- **审批要求**：无需人工审批
- **发布特性**：
  - 多格式同时发布
  - 版本控制支持
  - 元数据记录

### 12. 更新文档索引 (update_index)
- **目的**：更新文档目录和索引系统
- **执行方式**：索引管理操作
- **输出**：更新的索引信息
- **审批要求**：无需人工审批
- **索引内容**：
  - 文档类型
  - 创建时间
  - 版本信息
  - 标签分类

### 13. 通知相关人员 (notify_stakeholders)
- **目的**：通知相关人员文档发布完成
- **执行方式**：发送通知消息
- **输出**：通知发送状态
- **审批要求**：无需人工审批
- **通知内容**：
  - 文档摘要
  - 预览链接
  - 下载地址

### 14. 文档任务完成总结 (finalize)
- **目的**：生成文档生成任务的完成报告
- **AI提示词**：使用 `doc_finalize_prompt` 模板
- **输出**：完成总结报告

## 文档类型模板

### API文档 (api_documentation)
- **模板**：`api_doc_template`
- **必需章节**：
  - API概述
  - 认证机制
  - 接口列表
  - 错误码说明
  - SDK示例

### 用户手册 (user_manual)
- **模板**：`user_manual_template`
- **必需章节**：
  - 产品介绍
  - 快速开始
  - 功能详解
  - 常见问题
  - 故障排除

### 技术规范 (technical_specification)
- **模板**：`tech_spec_template`
- **必需章节**：
  - 技术架构
  - 系统要求
  - 接口规范
  - 数据模型
  - 部署指南

### 操作指南 (operation_guide)
- **模板**：`ops_guide_template`
- **必需章节**：
  - 环境准备
  - 安装部署
  - 配置管理
  - 监控运维
  - 应急处理

## DoD验证规则

### 数据收集验证
- 数据完整性检查通过
- 数据源有效性确认
- 关键信息覆盖率 ≥ 90%

### 大纲生成验证
- 大纲逻辑结构清晰
- 章节完整性确认
- 内容层次合理

### 内容生成验证
- 内容准确性检查通过
- 示例代码可执行
- 图表信息准确

### 图表生成验证
- 图表语法正确
- 图表信息完整
- 视觉效果清晰

### 格式转换验证
- 格式转换成功
- 排版效果良好
- 链接引用正确

## 配置选项

### 工作流特定配置
- `multi_format_support`: 是否启用多格式支持
- `template_driven`: 是否使用模板驱动生成
- `version_control`: 是否启用版本控制
- `collaborative_editing`: 是否支持协作编辑
- `auto_diagram_generation`: 是否自动生成图表

### 步骤级配置
每个步骤都可以配置：
- `pause_for_approval`: 是否暂停等待审批
- `dod_check`: 是否执行DoD验证
- `timeout`: 步骤超时时间
- 特定步骤的配置参数

## 产物输出

### 主要产物
- 文档结构表格
- 章节选择清单
- 收集的数据集
- 文档大纲
- 完整文档内容
- 配套图表
- 代码示例
- 多格式文档文件
- 任务完成报告

### 产物命名
所有产物按照 `{task_id}/{timestamp}/{step_name}` 的格式命名，确保唯一性和可追溯性。

## 扩展和定制

### 文档类型扩展
- 可以添加新的文档类型模板
- 定义特定的章节结构
- 配置专用的生成规则

### 格式支持扩展
- 可以添加新的输出格式
- 定制格式转换规则
- 配置美化选项

### 模板定制
- 可以修改AI提示词模板
- 可以调整图表生成策略
- 可以自定义审查标准

## 最佳实践

### 1. 数据源准备
- 确保代码库结构清晰
- 维护完整的配置文件
- 保持API接口文档更新
- 整理现有文档资源

### 2. 章节规划
- 根据目标用户选择合适章节
- 平衡内容详细程度和篇幅
- 考虑逻辑顺序和依赖关系
- 预留扩展和更新空间

### 3. 质量控制
- 定期审查生成的内容
- 验证代码示例的有效性
- 检查图表的准确性
- 确保格式的一致性

### 4. 维护更新
- 建立定期更新机制
- 跟踪代码变更影响
- 维护版本历史记录
- 收集用户反馈意见
